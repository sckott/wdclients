<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Building R Clients for Web Data</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="This book will teach you how to write API clients for R.">
  <meta name="generator" content="bookdown 0.0.73 and GitBook 2.6.7">

  <meta property="og:title" content="Building R Clients for Web Data" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/sckott/wdclients" />
  
  <meta property="og:description" content="This book will teach you how to write API clients for R." />
  <meta name="github-repo" content="sckott/wdclients" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Building R Clients for Web Data" />
  <meta name="twitter:site" content="@sckottie" />
  <meta name="twitter:description" content="This book will teach you how to write API clients for R." />
  

<meta name="author" content="Scott Chamberlain">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="caching.html">
<link rel="next" href="testing.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>

<link rel="stylesheet" href="wdclients.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Building R Clients For Web Data</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-you-will-learn"><i class="fa fa-check"></i><b>1.1</b> What you will learn</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#prerequisites"><i class="fa fa-check"></i><b>1.2</b> Prerequisites</a><ul>
<li class="chapter" data-level="1.2.1" data-path="introduction.html"><a href="introduction.html#r-packages"><i class="fa fa-check"></i><b>1.2.1</b> R packages</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#acknowledgements"><i class="fa fa-check"></i><b>1.3</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#colophon"><i class="fa fa-check"></i><b>1.4</b> Colophon</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-types.html"><a href="data-types.html"><i class="fa fa-check"></i><b>2</b> Data Types</a><ul>
<li class="chapter" data-level="2.1" data-path="data-types.html"><a href="data-types.html#json"><i class="fa fa-check"></i><b>2.1</b> JSON</a></li>
<li class="chapter" data-level="2.2" data-path="data-types.html"><a href="data-types.html#xml"><i class="fa fa-check"></i><b>2.2</b> XML</a></li>
<li class="chapter" data-level="2.3" data-path="data-types.html"><a href="data-types.html#html"><i class="fa fa-check"></i><b>2.3</b> HTML</a></li>
<li class="chapter" data-level="2.4" data-path="data-types.html"><a href="data-types.html#files"><i class="fa fa-check"></i><b>2.4</b> Files</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="apis.html"><a href="apis.html"><i class="fa fa-check"></i><b>3</b> APIs</a><ul>
<li class="chapter" data-level="3.1" data-path="apis.html"><a href="apis.html#breakdown-of-the-types"><i class="fa fa-check"></i><b>3.1</b> Breakdown of the types</a></li>
<li class="chapter" data-level="3.2" data-path="apis.html"><a href="apis.html#rpc"><i class="fa fa-check"></i><b>3.2</b> RPC</a></li>
<li class="chapter" data-level="3.3" data-path="apis.html"><a href="apis.html#soap"><i class="fa fa-check"></i><b>3.3</b> SOAP</a></li>
<li class="chapter" data-level="3.4" data-path="apis.html"><a href="apis.html#rest"><i class="fa fa-check"></i><b>3.4</b> REST</a></li>
<li class="chapter" data-level="3.5" data-path="apis.html"><a href="apis.html#others"><i class="fa fa-check"></i><b>3.5</b> Others</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="working-with-apis.html"><a href="working-with-apis.html"><i class="fa fa-check"></i><b>4</b> Working with APIs</a><ul>
<li class="chapter" data-level="4.1" data-path="working-with-apis.html"><a href="working-with-apis.html#xxx"><i class="fa fa-check"></i><b>4.1</b> xxx</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="api-clients.html"><a href="api-clients.html"><i class="fa fa-check"></i><b>5</b> API clients</a><ul>
<li class="chapter" data-level="5.1" data-path="api-clients.html"><a href="api-clients.html#writing-r-packages"><i class="fa fa-check"></i><b>5.1</b> Writing R packages</a></li>
<li class="chapter" data-level="5.2" data-path="api-clients.html"><a href="api-clients.html#core-http-helpers"><i class="fa fa-check"></i><b>5.2</b> Core HTTP helpers</a></li>
<li class="chapter" data-level="5.3" data-path="api-clients.html"><a href="api-clients.html#what-to-return-to-users"><i class="fa fa-check"></i><b>5.3</b> What to return to users</a></li>
<li class="chapter" data-level="5.4" data-path="api-clients.html"><a href="api-clients.html#abstracted-vs.1-to-1-user-interfaces"><i class="fa fa-check"></i><b>5.4</b> Abstracted vs. 1-to-1 user interfaces</a></li>
<li class="chapter" data-level="5.5" data-path="api-clients.html"><a href="api-clients.html#http-request-inspection"><i class="fa fa-check"></i><b>5.5</b> HTTP request inspection</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="curl.html"><a href="curl.html"><i class="fa fa-check"></i><b>6</b> curl</a><ul>
<li class="chapter" data-level="6.1" data-path="curl.html"><a href="curl.html#discover-curl-options"><i class="fa fa-check"></i><b>6.1</b> Discover curl options</a></li>
<li class="chapter" data-level="6.2" data-path="curl.html"><a href="curl.html#other-ways-to-use-curl-besides-r"><i class="fa fa-check"></i><b>6.2</b> Other ways to use curl besides R</a></li>
<li class="chapter" data-level="6.3" data-path="curl.html"><a href="curl.html#install-httr"><i class="fa fa-check"></i><b>6.3</b> Install httr</a></li>
<li class="chapter" data-level="6.4" data-path="curl.html"><a href="curl.html#general-option-setting"><i class="fa fa-check"></i><b>6.4</b> general option setting</a></li>
<li class="chapter" data-level="6.5" data-path="curl.html"><a href="curl.html#curl-options-in-ropensci-packages"><i class="fa fa-check"></i><b>6.5</b> curl options in rOpenSci packages</a></li>
<li class="chapter" data-level="6.6" data-path="curl.html"><a href="curl.html#timeout"><i class="fa fa-check"></i><b>6.6</b> timeout</a></li>
<li class="chapter" data-level="6.7" data-path="curl.html"><a href="curl.html#verbose"><i class="fa fa-check"></i><b>6.7</b> verbose</a></li>
<li class="chapter" data-level="6.8" data-path="curl.html"><a href="curl.html#headers"><i class="fa fa-check"></i><b>6.8</b> headers</a></li>
<li class="chapter" data-level="6.9" data-path="curl.html"><a href="curl.html#authenticate"><i class="fa fa-check"></i><b>6.9</b> authenticate</a></li>
<li class="chapter" data-level="6.10" data-path="curl.html"><a href="curl.html#cookies"><i class="fa fa-check"></i><b>6.10</b> cookies</a></li>
<li class="chapter" data-level="6.11" data-path="curl.html"><a href="curl.html#progress"><i class="fa fa-check"></i><b>6.11</b> progress</a></li>
<li class="chapter" data-level="6.12" data-path="curl.html"><a href="curl.html#proxies"><i class="fa fa-check"></i><b>6.12</b> proxies</a></li>
<li class="chapter" data-level="6.13" data-path="curl.html"><a href="curl.html#user-agent"><i class="fa fa-check"></i><b>6.13</b> user agent</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ftp.html"><a href="ftp.html"><i class="fa fa-check"></i><b>7</b> FTP</a></li>
<li class="chapter" data-level="8" data-path="http.html"><a href="http.html"><i class="fa fa-check"></i><b>8</b> HTTP</a><ul>
<li class="chapter" data-level="8.1" data-path="http.html"><a href="http.html#http2"><i class="fa fa-check"></i><b>8.1</b> HTTP/2</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="caching.html"><a href="caching.html"><i class="fa fa-check"></i><b>9</b> Caching</a><ul>
<li class="chapter" data-level="9.1" data-path="caching.html"><a href="caching.html#why-cache"><i class="fa fa-check"></i><b>9.1</b> Why cache?</a></li>
<li class="chapter" data-level="9.2" data-path="caching.html"><a href="caching.html#http-based-caching"><i class="fa fa-check"></i><b>9.2</b> http based caching</a></li>
<li class="chapter" data-level="9.3" data-path="caching.html"><a href="caching.html#r-based-caching"><i class="fa fa-check"></i><b>9.3</b> R based caching</a><ul>
<li class="chapter" data-level="9.3.1" data-path="caching.html"><a href="caching.html#vcr"><i class="fa fa-check"></i><b>9.3.1</b> vcr</a></li>
<li class="chapter" data-level="9.3.2" data-path="caching.html"><a href="caching.html#rappdirs"><i class="fa fa-check"></i><b>9.3.2</b> rappdirs</a></li>
<li class="chapter" data-level="9.3.3" data-path="caching.html"><a href="caching.html#other-packages"><i class="fa fa-check"></i><b>9.3.3</b> other packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="packaging.html"><a href="packaging.html"><i class="fa fa-check"></i><b>10</b> Packaging</a><ul>
<li class="chapter" data-level="10.1" data-path="packaging.html"><a href="packaging.html#http-functions"><i class="fa fa-check"></i><b>10.1</b> HTTP functions</a></li>
<li class="chapter" data-level="10.2" data-path="packaging.html"><a href="packaging.html#curl-options"><i class="fa fa-check"></i><b>10.2</b> Curl options</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="testing.html"><a href="testing.html"><i class="fa fa-check"></i><b>11</b> Testing</a><ul>
<li class="chapter" data-level="11.1" data-path="testing.html"><a href="testing.html#testthat"><i class="fa fa-check"></i><b>11.1</b> testthat</a><ul>
<li class="chapter" data-level="11.1.1" data-path="testing.html"><a href="testing.html#skipping-tests"><i class="fa fa-check"></i><b>11.1.1</b> Skipping tests</a></li>
<li class="chapter" data-level="11.1.2" data-path="testing.html"><a href="testing.html#test-if-web-resource-is-up"><i class="fa fa-check"></i><b>11.1.2</b> Test if web resource is up</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="testing.html"><a href="testing.html#mocking-web-requests"><i class="fa fa-check"></i><b>11.2</b> Mocking web requests</a><ul>
<li class="chapter" data-level="11.2.1" data-path="testing.html"><a href="testing.html#vcr-1"><i class="fa fa-check"></i><b>11.2.1</b> vcr</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="testing.html"><a href="testing.html#webmockr"><i class="fa fa-check"></i><b>11.3</b> webmockr</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="package-automation.html"><a href="package-automation.html"><i class="fa fa-check"></i><b>12</b> Package Automation</a><ul>
<li class="chapter" data-level="12.1" data-path="package-automation.html"><a href="package-automation.html#api-specifications"><i class="fa fa-check"></i><b>12.1</b> API Specifications</a></li>
<li class="chapter" data-level="12.2" data-path="package-automation.html"><a href="package-automation.html#package-generator"><i class="fa fa-check"></i><b>12.2</b> Package generator</a></li>
<li class="chapter" data-level="12.3" data-path="package-automation.html"><a href="package-automation.html#keeping-up-to-date"><i class="fa fa-check"></i><b>12.3</b> Keeping up to date</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Building R Clients for Web Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="packaging" class="section level1">
<h1><span class="header-section-number">10</span> Packaging</h1>
<p>Hadley Wickham’s book <em>R Package Development</em> (ref) covers R package development in detail - thus, I will focus in this chapter on those aspects of package development that are most relavant to developing packages for consuming web resources.</p>
<div id="http-functions" class="section level2">
<h2><span class="header-section-number">10.1</span> HTTP functions</h2>
<p>You’ll likely need to use the same or similar code to request web resources. Therefore, it usually makes sense to have a file with these internal functions, and then reuse them wherever needed. This way, when changes are needed for internal HTTP functions you can make changes in one place. This is essentially the same as saying Don’t Repeat Yourself (DRY).</p>
<p>A good way to write internal HTTP functions for a web resource is as follows:</p>
<p>First, define a generic function that can be used for any HTTP verb:</p>
<pre class="sourceCode r"><code class="sourceCode r">my_VERB &lt;-<span class="st"> </span>function(verb, url, ...) {
  url &lt;-<span class="st"> </span><span class="kw">as.url</span>(url)
  VERB &lt;-<span class="st"> </span><span class="kw">getExportedValue</span>(<span class="st">&quot;httr&quot;</span>, verb)

  res &lt;-<span class="st"> </span><span class="kw">VERB</span>(url, ..., <span class="kw">do_oauth</span>())
  <span class="co"># No content</span>
  if (<span class="kw">length</span>(res$content) ==<span class="st"> </span><span class="dv">0</span>) {
    httr::<span class="kw">stop_for_status</span>(res)
    <span class="kw">return</span>(<span class="kw">invisible</span>(<span class="ot">TRUE</span>))
  }

  text &lt;-<span class="st"> </span>httr::<span class="kw">content</span>(res, <span class="dt">as =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>)
  json &lt;-<span class="st"> </span>jsonlite::<span class="kw">fromJSON</span>(text, <span class="dt">simplifyVector =</span> <span class="ot">FALSE</span>)

  if (httr::<span class="kw">status_code</span>(res) &gt;=<span class="st"> </span><span class="dv">400</span>) {
    <span class="kw">stop</span>(json$message, <span class="dt">call. =</span> <span class="ot">FALSE</span>)
  }

  json
}</code></pre>
<p>Then, define functions for each of the HTTP verbs you need:</p>
<p>GET</p>
<pre class="sourceCode r"><code class="sourceCode r">do_GET &lt;-<span class="st"> </span>function(url, ...) {
  <span class="kw">my_VERB</span>(<span class="st">&quot;GET&quot;</span>, url, ...)
}</code></pre>
<p>POST</p>
<pre class="sourceCode r"><code class="sourceCode r">do_POST &lt;-<span class="st"> </span>function(url, ..., <span class="dt">body =</span> <span class="ot">NULL</span>, <span class="dt">encode =</span> <span class="st">&quot;json&quot;</span>) {
  body &lt;-<span class="st"> </span><span class="kw">ascompact</span>(body)
  <span class="kw">my_VERB</span>(<span class="st">&quot;POST&quot;</span>, url, ..., <span class="dt">body =</span> body, <span class="dt">encode =</span> encode)
}</code></pre>
<p>PUT</p>
<pre class="sourceCode r"><code class="sourceCode r">do_PUT &lt;-<span class="st"> </span>function(url, ...) {
  <span class="kw">my_VERB</span>(<span class="st">&quot;PUT&quot;</span>, url, ...)
}</code></pre>
<p>DELETE</p>
<pre class="sourceCode r"><code class="sourceCode r">do_DELETE &lt;-<span class="st"> </span>function(url, ...) {
  <span class="kw">my_VERB</span>(<span class="st">&quot;DELETE&quot;</span>, url, ...)
}</code></pre>
</div>
<div id="curl-options" class="section level2">
<h2><span class="header-section-number">10.2</span> Curl options</h2>
<p>It’s best practice to always allow users to pass in curl options. Many users will never need these, but power users that are familiar with curl will appreciate the option.</p>
<p>In addition, there are a number of situations that will make you glad you built it in. When users of your package are at a workplace, they can sometimes be blocked from accessing the resources your package works with - either because some ports are blocked, or otehr reasons. If they can pass in curl options they can often get around these issues.</p>
<p>Curl options also allow users to pass in headers, which are important in many situations.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="caching.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="testing.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/sckott/wdclients/edit/master/packaging.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
