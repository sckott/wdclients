<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Building API Clients</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="This book will teach you how to write API clients for R.">
  <meta name="generator" content="bookdown 0.0.60 and GitBook 2.6.7">

  <meta property="og:title" content="Building API Clients" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/sckott/apiclients" />
  
  <meta property="og:description" content="This book will teach you how to write API clients for R." />
  <meta name="github-repo" content="sckott/apiclients" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Building API Clients" />
  <meta name="twitter:site" content="@sckottie" />
  <meta name="twitter:description" content="This book will teach you how to write API clients for R." />
  

<meta name="author" content="Scott Chamberlain">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="api-clients.html">
<link rel="next" href="ftp.html">

<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>

<link rel="stylesheet" href="wdclients.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Building R Clients For Web Data</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#what-you-will-learn"><i class="fa fa-check"></i><b>2.1</b> What you will learn</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#prerequisites"><i class="fa fa-check"></i><b>2.2</b> Prerequisites</a><ul>
<li class="chapter" data-level="2.2.1" data-path="introduction.html"><a href="introduction.html#r-packages"><i class="fa fa-check"></i><b>2.2.1</b> R packages</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#acknowledgements"><i class="fa fa-check"></i><b>2.3</b> Acknowledgements</a></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#colophon"><i class="fa fa-check"></i><b>2.4</b> Colophon</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-types.html"><a href="data-types.html"><i class="fa fa-check"></i><b>3</b> Data Types</a><ul>
<li class="chapter" data-level="3.1" data-path="data-types.html"><a href="data-types.html#json"><i class="fa fa-check"></i><b>3.1</b> JSON</a></li>
<li class="chapter" data-level="3.2" data-path="data-types.html"><a href="data-types.html#xml"><i class="fa fa-check"></i><b>3.2</b> XML</a></li>
<li class="chapter" data-level="3.3" data-path="data-types.html"><a href="data-types.html#html"><i class="fa fa-check"></i><b>3.3</b> HTML</a></li>
<li class="chapter" data-level="3.4" data-path="data-types.html"><a href="data-types.html#files"><i class="fa fa-check"></i><b>3.4</b> Files</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="apis.html"><a href="apis.html"><i class="fa fa-check"></i><b>4</b> APIs</a><ul>
<li class="chapter" data-level="4.1" data-path="apis.html"><a href="apis.html#breakdown-of-the-types"><i class="fa fa-check"></i><b>4.1</b> Breakdown of the types</a></li>
<li class="chapter" data-level="4.2" data-path="apis.html"><a href="apis.html#soap"><i class="fa fa-check"></i><b>4.2</b> SOAP</a></li>
<li class="chapter" data-level="4.3" data-path="apis.html"><a href="apis.html#rpc"><i class="fa fa-check"></i><b>4.3</b> RPC</a></li>
<li class="chapter" data-level="4.4" data-path="apis.html"><a href="apis.html#rest"><i class="fa fa-check"></i><b>4.4</b> REST</a></li>
<li class="chapter" data-level="4.5" data-path="apis.html"><a href="apis.html#others"><i class="fa fa-check"></i><b>4.5</b> Others</a></li>
<li class="chapter" data-level="4.6" data-path="apis.html"><a href="apis.html#http"><i class="fa fa-check"></i><b>4.6</b> HTTP</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="working-with-apis.html"><a href="working-with-apis.html"><i class="fa fa-check"></i><b>5</b> Working with APIs</a><ul>
<li class="chapter" data-level="5.1" data-path="working-with-apis.html"><a href="working-with-apis.html#xxx"><i class="fa fa-check"></i><b>5.1</b> xxx</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="api-clients.html"><a href="api-clients.html"><i class="fa fa-check"></i><b>6</b> API clients</a><ul>
<li class="chapter" data-level="6.1" data-path="api-clients.html"><a href="api-clients.html#writing-r-packages"><i class="fa fa-check"></i><b>6.1</b> Writing R packages</a></li>
<li class="chapter" data-level="6.2" data-path="api-clients.html"><a href="api-clients.html#core-http-helpers"><i class="fa fa-check"></i><b>6.2</b> Core HTTP helpers</a></li>
<li class="chapter" data-level="6.3" data-path="api-clients.html"><a href="api-clients.html#what-to-return-to-users"><i class="fa fa-check"></i><b>6.3</b> What to return to users</a></li>
<li class="chapter" data-level="6.4" data-path="api-clients.html"><a href="api-clients.html#abstracted-vs.1-to-1-user-interfaces"><i class="fa fa-check"></i><b>6.4</b> Abstracted vs. 1-to-1 user interfaces</a></li>
<li class="chapter" data-level="6.5" data-path="api-clients.html"><a href="api-clients.html#http-request-inspection"><i class="fa fa-check"></i><b>6.5</b> HTTP request inspection</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="curl.html"><a href="curl.html"><i class="fa fa-check"></i><b>7</b> curl</a><ul>
<li class="chapter" data-level="7.1" data-path="curl.html"><a href="curl.html#discover-curl-options"><i class="fa fa-check"></i><b>7.1</b> Discover curl options</a></li>
<li class="chapter" data-level="7.2" data-path="curl.html"><a href="curl.html#other-ways-to-use-curl-besides-r"><i class="fa fa-check"></i><b>7.2</b> Other ways to use curl besides R</a></li>
<li class="chapter" data-level="7.3" data-path="curl.html"><a href="curl.html#install-httr"><i class="fa fa-check"></i><b>7.3</b> Install httr</a></li>
<li class="chapter" data-level="7.4" data-path="curl.html"><a href="curl.html#general-option-setting"><i class="fa fa-check"></i><b>7.4</b> general option setting</a></li>
<li class="chapter" data-level="7.5" data-path="curl.html"><a href="curl.html#curl-options-in-ropensci-packages"><i class="fa fa-check"></i><b>7.5</b> curl options in rOpenSci packages</a></li>
<li class="chapter" data-level="7.6" data-path="curl.html"><a href="curl.html#timeout"><i class="fa fa-check"></i><b>7.6</b> timeout</a></li>
<li class="chapter" data-level="7.7" data-path="curl.html"><a href="curl.html#verbose"><i class="fa fa-check"></i><b>7.7</b> verbose</a></li>
<li class="chapter" data-level="7.8" data-path="curl.html"><a href="curl.html#headers"><i class="fa fa-check"></i><b>7.8</b> headers</a></li>
<li class="chapter" data-level="7.9" data-path="curl.html"><a href="curl.html#authenticate"><i class="fa fa-check"></i><b>7.9</b> authenticate</a></li>
<li class="chapter" data-level="7.10" data-path="curl.html"><a href="curl.html#cookies"><i class="fa fa-check"></i><b>7.10</b> cookies</a></li>
<li class="chapter" data-level="7.11" data-path="curl.html"><a href="curl.html#progress"><i class="fa fa-check"></i><b>7.11</b> progress</a></li>
<li class="chapter" data-level="7.12" data-path="curl.html"><a href="curl.html#proxies"><i class="fa fa-check"></i><b>7.12</b> proxies</a></li>
<li class="chapter" data-level="7.13" data-path="curl.html"><a href="curl.html#user-agent"><i class="fa fa-check"></i><b>7.13</b> user agent</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="ftp.html"><a href="ftp.html"><i class="fa fa-check"></i><b>8</b> FTP</a></li>
<li class="chapter" data-level="9" data-path="http-1.html"><a href="http-1.html"><i class="fa fa-check"></i><b>9</b> HTTP</a></li>
<li class="chapter" data-level="10" data-path="caching.html"><a href="caching.html"><i class="fa fa-check"></i><b>10</b> Caching</a><ul>
<li class="chapter" data-level="10.1" data-path="caching.html"><a href="caching.html#why-cache"><i class="fa fa-check"></i><b>10.1</b> Why cache?</a></li>
<li class="chapter" data-level="10.2" data-path="caching.html"><a href="caching.html#http-based-caching"><i class="fa fa-check"></i><b>10.2</b> http based caching</a></li>
<li class="chapter" data-level="10.3" data-path="caching.html"><a href="caching.html#r-based-caching"><i class="fa fa-check"></i><b>10.3</b> R based caching</a><ul>
<li class="chapter" data-level="10.3.1" data-path="caching.html"><a href="caching.html#vcr"><i class="fa fa-check"></i><b>10.3.1</b> vcr</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="packaging.html"><a href="packaging.html"><i class="fa fa-check"></i><b>11</b> Packaging</a></li>
<li class="chapter" data-level="12" data-path="testing.html"><a href="testing.html"><i class="fa fa-check"></i><b>12</b> Testing</a><ul>
<li class="chapter" data-level="12.1" data-path="testing.html"><a href="testing.html#testthat"><i class="fa fa-check"></i><b>12.1</b> testthat</a></li>
<li class="chapter" data-level="12.2" data-path="testing.html"><a href="testing.html#vcr-1"><i class="fa fa-check"></i><b>12.2</b> vcr</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="package-automation.html"><a href="package-automation.html"><i class="fa fa-check"></i><b>13</b> Package Automation</a><ul>
<li class="chapter" data-level="13.1" data-path="package-automation.html"><a href="package-automation.html#api-specifications"><i class="fa fa-check"></i><b>13.1</b> API Specifications</a></li>
<li class="chapter" data-level="13.2" data-path="package-automation.html"><a href="package-automation.html#package-generator"><i class="fa fa-check"></i><b>13.2</b> Package generator</a></li>
<li class="chapter" data-level="13.3" data-path="package-automation.html"><a href="package-automation.html#keeping-up-to-date"><i class="fa fa-check"></i><b>13.3</b> Keeping up to date</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Building API Clients</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="curl" class="section level1">
<h1><span class="header-section-number">7</span> curl</h1>
<p>curl is the de facto standard tool for making HTTP requests - in addition to many other types of data requests. It is also an R package (<a href="https://cran.rstudio.com/web/packages/curl/" class="uri">https://cran.rstudio.com/web/packages/curl/</a>).</p>
<div id="discover-curl-options" class="section level2">
<h2><span class="header-section-number">7.1</span> Discover curl options</h2>
<p>You can go to the source, that is the curl manual page at <a href="http://curl.haxx.se/docs/manpage.html"><a href="http://curl.haxx.se/docs/manpage.html" class="uri">http://curl.haxx.se/docs/manpage.html</a></a>. In R: <code>RCurl::listCurlOptions()</code> for finding curl options, give website for more info and equivalent call in <code>httr</code> is <code>httr::httr_options()</code>. <code>httr::httr_options()</code> gives more information for each curl option, including the libcurl variable name (e.g., <code>CURLOPT_CERTINFO</code>) and the type of variable (e.g., logical).</p>
</div>
<div id="other-ways-to-use-curl-besides-r" class="section level2">
<h2><span class="header-section-number">7.2</span> Other ways to use curl besides R</h2>
<p>Perhaps the canonical way to use curl is on the command line. You can get curl for your operating system at <a href="http://curl.haxx.se/download.html"><a href="http://curl.haxx.se/download.html" class="uri">http://curl.haxx.se/download.html</a></a>, though hopefully you already have curl. Once you have curl, you can have lots of fun. For example, get the contents of the Google landing page:</p>
<pre class="sh"><code>curl https://www.google.com</code></pre>
<ul>
<li>If you like that you may also like <a href="https://github.com/jakubroztocil/httpie">httpie</a>, a Python command line tool that is a little more convenient than curl (e.g., JSON output is automatically parsed and colorized).</li>
<li>Alot of data from the web is in JSON format. A great command line tool to pair with <code>curl</code> is <a href="http://stedolan.github.io/jq/">jq</a>.</li>
</ul>
<blockquote>
<p>Note: if you are on windows you may require extra setup if you want to play with curl on the command line. OSX and linux have it by default. On Windows 8, installing the latest version from here <a href="http://curl.haxx.se/download.html#Win64" class="uri">http://curl.haxx.se/download.html#Win64</a> worked for me.</p>
</blockquote>
</div>
<div id="install-httr" class="section level2">
<h2><span class="header-section-number">7.3</span> Install httr</h2>
<blockquote>
<p>Note: <code>RCurl</code> is a dependency, so you’ll get it when you install <code>httr</code></p>
</blockquote>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;httr&quot;</span>)</code></pre>
<p>There are some new features in <code>httr</code> dev version you may want. If so, do:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)
devtools::<span class="kw">install_github</span>(<span class="st">&quot;hadley/httr&quot;</span>)</code></pre>
<p>Load <code>httr</code></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;httr&quot;</span>)</code></pre>
</div>
<div id="general-option-setting" class="section level2">
<h2><span class="header-section-number">7.4</span> general option setting</h2>
<p>With <code>httr</code> you can either set globally for an R session like</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set_config</span>(<span class="kw">timeout</span>(<span class="dt">seconds =</span> <span class="dv">2</span>))</code></pre>
<p>Or use <code>with_config()</code></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">with_config</span>(<span class="kw">verbose</span>(), {
  <span class="kw">GET</span>(<span class="st">&quot;http://www.google.com/search&quot;</span>)
})</code></pre>
<p>Or extensions to <code>with_*</code>, like for <code>verbose</code> output</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">with_verbose</span>(
  <span class="kw">GET</span>(<span class="st">&quot;http://www.google.com/search&quot;</span>)
)
<span class="co">#&gt; Response [http://www.google.com/webhp]</span>
<span class="co">#&gt;   Date: 2016-04-15 13:53</span>
<span class="co">#&gt;   Status: 200</span>
<span class="co">#&gt;   Content-Type: text/html; charset=ISO-8859-1</span>
<span class="co">#&gt;   Size: 10.5 kB</span>
<span class="co">#&gt; &lt;!doctype html&gt;&lt;html itemscope=&quot;&quot; itemtype=&quot;http://schema.org/WebPage&quot; l...</span>
<span class="co">#&gt; function _gjh(){!_gjuc()&amp;&amp;window.google&amp;&amp;google.x&amp;&amp;google.x({id:&quot;GJH&quot;},f...</span>
<span class="co">#&gt; &lt;/style&gt;&lt;style&gt;body,td,a,p,.h{font-family:arial,sans-serif}body{margin:0...</span>
<span class="co">#&gt; if (!iesg){document.f&amp;&amp;document.f.q.focus();document.gbqf&amp;&amp;document.gbqf...</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; })();&lt;/script&gt;&lt;div id=&quot;mngb&quot;&gt;    &lt;div id=gbar&gt;&lt;nobr&gt;&lt;b class=gb1&gt;Search&lt;...</span></code></pre>
<p>Or pass into each function call</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">GET</span>(<span class="st">&quot;http://www.google.com/search&quot;</span>, <span class="dt">query=</span><span class="kw">list</span>(<span class="dt">q=</span><span class="st">&quot;httr&quot;</span>), <span class="kw">timeout</span>(<span class="dt">seconds =</span> <span class="fl">0.5</span>))</code></pre>
<p>With <code>RCurl</code> you can set options for a function call by passing curl options to the <code>.opts</code> parameter</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getForm</span>(<span class="st">&quot;http://www.google.com/search?q=RCurl&quot;</span>, <span class="dt">btnG=</span><span class="st">&quot;Search&quot;</span>, <span class="dt">.opts =</span> <span class="kw">list</span>(<span class="dt">timeout.ms =</span> <span class="dv">20</span>))</code></pre>
<p>For all examples below I’ll use <code>httr</code>, and pass in config options to function calls.</p>
</div>
<div id="curl-options-in-ropensci-packages" class="section level2">
<h2><span class="header-section-number">7.5</span> curl options in rOpenSci packages</h2>
<p>In most of our packages we allow you to pass in any curl options, either via <code>...</code> or a named parameter. We are increasingly making our packages consistent, but they may not all have this ability yet. For example, using the <code>rgbif</code> package, an R client for <a href="http://www.gbif.org/">GBIF</a>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;rgbif&quot;</span>)</code></pre>
<p>verbose output</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;rgbif&quot;</span>)
res &lt;-<span class="st"> </span><span class="kw">occ_search</span>(<span class="dt">geometry=</span><span class="kw">c</span>(-<span class="fl">125.0</span>,<span class="fl">38.4</span>,-<span class="fl">121.8</span>,<span class="fl">40.9</span>), <span class="dt">limit=</span><span class="dv">20</span>, <span class="dt">config=</span><span class="kw">verbose</span>())
<span class="co">#&gt; -&gt; GET /v1/occurrence/search?geometry=POLYGON%28%28-125%2038.4%2C%20-121.8%2038.4%2C%20-121.8%2040.9%2C%20-125%2040.9%2C%20-125%2038.4%29%29&amp;limit=20&amp;offset=0 HTTP/1.1</span>
<span class="co">#&gt; -&gt; User-Agent: curl/7.37.1 Rcurl/1.95.4.5 httr/0.6.0</span>
<span class="co">#&gt; -&gt; Host: api.gbif.org</span>
<span class="co">#&gt; -&gt; Accept-Encoding: gzip</span>
<span class="co">#&gt; -&gt; Accept: application/json, text/xml, application/xml, */*</span>
<span class="co">#&gt; -&gt;</span>
<span class="co">#&gt; &lt;- HTTP/1.1 200 OK</span>
<span class="co">#&gt; &lt;- Content-Type: application/json</span>
<span class="co">#&gt; &lt;- Access-Control-Allow-Origin: *</span>
<span class="co">#&gt; &lt;- Server: Jetty(9.1.z-SNAPSHOT)</span>
<span class="co">#&gt; &lt;- x-api-url: /v1/occurrence/search?geometry=POLYGON%28%28-125%2038.4%2C%20-121.8%2038.4%2C%20-121.8%2040.9%2C%20-125%2040.9%2C%20-125%2038.4%29%29&amp;limit=20&amp;offset=0</span>
<span class="co">#&gt; &lt;- Content-Length: 48698</span>
<span class="co">#&gt; &lt;- Accept-Ranges: bytes</span>
<span class="co">#&gt; &lt;- Date: Tue, 16 Dec 2014 23:35:52 GMT</span>
<span class="co">#&gt; &lt;- X-Varnish: 1067986052 1067940827</span>
<span class="co">#&gt; &lt;- Age: 209</span>
<span class="co">#&gt; &lt;- Via: 1.1 varnish</span>
<span class="co">#&gt; &lt;- Connection: keep-alive</span>
<span class="co">#&gt; &lt;-</span></code></pre>
<p>Print progress</p>
<pre class="sourceCode r"><code class="sourceCode r">res &lt;-<span class="st"> </span><span class="kw">occ_search</span>(<span class="dt">geometry=</span><span class="kw">c</span>(-<span class="fl">125.0</span>,<span class="fl">38.4</span>,-<span class="fl">121.8</span>,<span class="fl">40.9</span>), <span class="dt">limit=</span><span class="dv">20</span>, <span class="dt">config=</span><span class="kw">progress</span>())
<span class="co">#&gt; |===================================================================| 100%</span></code></pre>
<p>You can also combine curl options - use <code>c()</code> in this case to combine them</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(<span class="kw">verbose</span>(), <span class="kw">progress</span>())
<span class="co">#&gt; &lt;request&gt;</span>
<span class="co">#&gt; Options:</span>
<span class="co">#&gt; * debugfunction: function (type, msg) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     switch(type + 1, text = if (info) prefix_message(&quot;*  &quot;, msg), headerIn = prefix_message(&quot;&lt;- &quot;, msg), headerOut = prefix_message(&quot;-&gt; &quot;, msg), dataIn = if (data_in) prefix_message(&quot;&lt;&lt;  &quot;, msg, TRUE), dataOut = if (data_out) prefix_message(&quot;&gt;&gt; &quot;, msg, TRUE), sslDataIn = if (data_in &amp;&amp; ssl) prefix_message(&quot;*&lt; &quot;, msg, TRUE), sslDataOut = if (data_out &amp;&amp; ssl) prefix_message(&quot;*&gt; &quot;, msg, TRUE))</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; * verbose: TRUE</span>
<span class="co">#&gt; * noprogress: FALSE</span>
<span class="co">#&gt; * progressfunction: function (down, up) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     if (type == &quot;down&quot;) {</span>
<span class="co">#&gt;         total &lt;- down[[1]]</span>
<span class="co">#&gt;         now &lt;- down[[2]]</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else {</span>
<span class="co">#&gt;         total &lt;- up[[1]]</span>
<span class="co">#&gt;         now &lt;- up[[2]]</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     if (total == 0 &amp;&amp; now == 0) {</span>
<span class="co">#&gt;         bar &lt;&lt;- NULL</span>
<span class="co">#&gt;         first &lt;&lt;- TRUE</span>
<span class="co">#&gt;         return(TRUE)</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     if (total == 0) {</span>
<span class="co">#&gt;         if (first) {</span>
<span class="co">#&gt;             first &lt;&lt;- FALSE</span>
<span class="co">#&gt;         }</span>
<span class="co">#&gt;         cat(&quot;\rDownloading: &quot;, bytes(now, digits = 2), &quot;     &quot;, sep = &quot;&quot;)</span>
<span class="co">#&gt;         if (now == total) </span>
<span class="co">#&gt;             cat(&quot;\n&quot;)</span>
<span class="co">#&gt;         utils::flush.console()</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else {</span>
<span class="co">#&gt;         if (is.null(bar)) {</span>
<span class="co">#&gt;             bar &lt;&lt;- utils::txtProgressBar(max = total, style = 3)</span>
<span class="co">#&gt;         }</span>
<span class="co">#&gt;         utils::setTxtProgressBar(bar, now)</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     TRUE</span>
<span class="co">#&gt; }</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r">res &lt;-<span class="st"> </span><span class="kw">occ_search</span>(<span class="dt">geometry=</span><span class="kw">c</span>(-<span class="fl">125.0</span>,<span class="fl">38.4</span>,-<span class="fl">121.8</span>,<span class="fl">40.9</span>), <span class="dt">limit=</span><span class="dv">20</span>, <span class="dt">config=</span><span class="kw">c</span>(<span class="kw">verbose</span>(), <span class="kw">progress</span>()))
<span class="co">#&gt; -&gt; GET /v1/occurrence/search?geometry=POLYGON%28%28-125%2038.4%2C%20-121.8%2038.4%2C%20-121.8%2040.9%2C%20-125%2040.9%2C%20-125%2038.4%29%29&amp;limit=20&amp;offset=0 HTTP/1.1</span>
<span class="co">#&gt; -&gt; User-Agent: curl/7.37.1 Rcurl/1.95.4.5 httr/0.6.0</span>
<span class="co">#&gt; -&gt; Host: api.gbif.org</span>
<span class="co">#&gt; -&gt; Accept-Encoding: gzip</span>
<span class="co">#&gt; -&gt; Accept: application/json, text/xml, application/xml, */*</span>
<span class="co">#&gt; -&gt;</span>
<span class="co">#&gt; &lt;- HTTP/1.1 200 OK</span>
<span class="co">#&gt; &lt;- Content-Type: application/json</span>
<span class="co">#&gt; &lt;- Access-Control-Allow-Origin: *</span>
<span class="co">#&gt; &lt;- Server: Jetty(9.1.z-SNAPSHOT)</span>
<span class="co">#&gt; &lt;- x-api-url: /v1/occurrence/search?geometry=POLYGON%28%28-125%2038.4%2C%20-121.8%2038.4%2C%20-121.8%2040.9%2C%20-125%2040.9%2C%20-125%2038.4%29%29&amp;limit=20&amp;offset=0</span>
<span class="co">#&gt; &lt;- Content-Length: 48698</span>
<span class="co">#&gt; &lt;- Accept-Ranges: bytes</span>
<span class="co">#&gt; &lt;- Date: Tue, 16 Dec 2014 23:35:52 GMT</span>
<span class="co">#&gt; &lt;- X-Varnish: 1067986052 1067940827</span>
<span class="co">#&gt; &lt;- Age: 209</span>
<span class="co">#&gt; &lt;- Via: 1.1 varnish</span>
<span class="co">#&gt; &lt;- Connection: keep-alive</span>
<span class="co">#&gt; &lt;-</span>
<span class="co">#&gt;   |======================================================================| 100%</span></code></pre>
</div>
<div id="timeout" class="section level2">
<h2><span class="header-section-number">7.6</span> timeout</h2>
<blockquote>
<p>Set a timeout for a request. If request exceeds timeout, request stops.</p>
</blockquote>
<ul>
<li><code>httr</code>: <code>timeout(seconds=2)</code> Here, the value is in seconds - converted to ms internally</li>
<li><code>RCurl</code>: <code>timeout.ms=2000</code> Here, the value is in ms</li>
</ul>
<blockquote>
<p>Note: For this section and those following, I’ll mention an <code>RCurl</code> equivalent if there is one.</p>
</blockquote>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">GET</span>(<span class="st">&quot;http://www.google.com/search&quot;</span>, <span class="kw">timeout</span>(<span class="fl">0.01</span>))
<span class="co">#&gt; Error in function (type, msg, asError = TRUE)  :</span>
<span class="co">#&gt;   Connection timed out after 16 milliseconds</span></code></pre>
<ul>
<li><em>Why use this?</em> You sometimes are working with a web resource that is somewhat unreliable. For example, if you want to run a script on a server that may take many hours, and the web resource could be down at some point during that time, you could set the timeout and error catch the response so that the script doesn’t hang on a server that’s not responding. Another example could be if you call a web resource in an R package. In your test suite, you may want to test that a web resource is responding quickly, so you could set a timeout, and not test if that fails.</li>
</ul>
</div>
<div id="verbose" class="section level2">
<h2><span class="header-section-number">7.7</span> verbose</h2>
<blockquote>
<p>Print detailed info on a curl call</p>
</blockquote>
<ul>
<li><code>httr</code>: <code>verbose()</code></li>
<li><code>RCurl</code>: <code>verbose=TRUE</code></li>
</ul>
<p>Just do a <code>HEAD</code> request so we don’t have to deal with big output</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">HEAD</span>(<span class="st">&quot;http://www.google.com/search&quot;</span>, <span class="kw">verbose</span>())
<span class="co">#&gt; -&gt; HEAD / HTTP/1.1</span>
<span class="co">#&gt; -&gt; User-Agent: curl/7.37.1 Rcurl/1.95.4.5 httr/0.6.0</span>
<span class="co">#&gt; -&gt; Host: had.co.nz</span>
<span class="co">#&gt; -&gt; Accept-Encoding: gzip</span>
<span class="co">#&gt; -&gt; Accept: application/json, text/xml, application/xml, */*</span>
<span class="co">#&gt; -&gt;</span>
<span class="co">#&gt; &lt;- HTTP/1.1 200 OK</span>
<span class="co">#&gt; &lt;- X-Powered-By: PHP/4.4.6</span>
<span class="co">#&gt; &lt;- Content-type: text/html</span>
<span class="co">#&gt; &lt;- Date: Tue, 16 Dec 2014 21:03:21 GMT</span>
<span class="co">#&gt; &lt;- Server: LiteSpeed</span>
<span class="co">#&gt; &lt;- Connection: Keep-Alive</span>
<span class="co">#&gt; &lt;- Keep-Alive: timeout=5, max=100</span>
<span class="co">#&gt; &lt;-</span>
<span class="co">#&gt; Response [http://had.co.nz/]</span>
<span class="co">#&gt;   Date: 2014-12-16 12:29</span>
<span class="co">#&gt;   Status: 200</span>
<span class="co">#&gt;   Content-Type: text/html</span>
<span class="co">#&gt; &lt;EMPTY BODY&gt;</span></code></pre>
<ul>
<li><em>Why use this?</em> As you can see verbose output gives you lots of information that may be useful for debugging a request. You typically don’t need verbose output unless you want to inspect a request.</li>
</ul>
</div>
<div id="headers" class="section level2">
<h2><span class="header-section-number">7.8</span> headers</h2>
<blockquote>
<p>Add headers to modify requests, including authentication, setting content-type, accept type, etc.</p>
</blockquote>
<ul>
<li><code>httr</code>: <code>add_headers()</code></li>
<li><code>RCurl</code>: <code>httpheader</code></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">res &lt;-<span class="st"> </span><span class="kw">HEAD</span>(<span class="st">&quot;http://www.google.com/search&quot;</span>, <span class="kw">add_headers</span>(<span class="dt">Accept =</span> <span class="st">&quot;application/json&quot;</span>))
res$request$opts$httpheader
<span class="co">#&gt; NULL</span></code></pre>
<blockquote>
<p>Note: there are shortcuts for <code>add_headers(Accept = &quot;application/json&quot;)</code> and add_headers(Accept = “application/xml”): <code>accept_json()</code>, and <code>accept_xml()</code></p>
</blockquote>
<ul>
<li><em>Why use this?</em> For some web resources, using headers is mandatory, and <code>httr</code> makes including them quite easy. Headers are nice too because e.g., passing authentication in the header instead of the URL string means your private data is not as exposed to prying eyes.</li>
</ul>
</div>
<div id="authenticate" class="section level2">
<h2><span class="header-section-number">7.9</span> authenticate</h2>
<blockquote>
<p>Set authentication details for a resource</p>
</blockquote>
<ul>
<li><code>httr</code>: <code>authenticate()</code>, <code>oauth2.0_token()</code>, <code>oauth_app()</code>, <code>oauth_endpoint()</code>, etc.</li>
<li><code>RCurl</code>: various</li>
</ul>
<p><code>authenticate()</code> for basic username/password authentication</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">authenticate</span>(<span class="dt">user =</span> <span class="st">&quot;foo&quot;</span>, <span class="dt">password =</span> <span class="st">&quot;bar&quot;</span>)
<span class="co">#&gt; &lt;request&gt;</span>
<span class="co">#&gt; Options:</span>
<span class="co">#&gt; * httpauth: 1</span>
<span class="co">#&gt; * userpwd: foo:bar</span></code></pre>
<p>To use an API key, this depends on the data provider. They may request it one or either of the header (in multiple different ways)</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">HEAD</span>(<span class="st">&quot;http://www.google.com/search&quot;</span>, <span class="kw">add_headers</span>(<span class="dt">Authorization =</span> <span class="st">&quot;Bearer 234kqhrlj2342&quot;</span>))
<span class="co"># or</span>
<span class="kw">HEAD</span>(<span class="st">&quot;http://www.google.com/search&quot;</span>, <span class="kw">add_headers</span>(<span class="st">&quot;token&quot;</span> =<span class="st"> &quot;234kqhrlj2342&quot;</span>))</code></pre>
<p>or as a query parameter (which is passed in the URL string)</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">HEAD</span>(<span class="st">&quot;http://www.google.com/search&quot;</span>, <span class="dt">query =</span> <span class="kw">list</span>(<span class="dt">api_key =</span> <span class="st">&quot;&lt;your key&gt;&quot;</span>))</code></pre>
<p>Another authentication options is OAuth workflows. <code>OAuth2</code> is probably more commonly used than <code>OAuth1</code>.</p>
<ul>
<li>Find OAuth settings for github <a href="http://developer.github.com/v3/oauth/" class="uri">http://developer.github.com/v3/oauth/</a></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">endpts &lt;-<span class="st"> </span><span class="kw">oauth_endpoint</span>(<span class="dt">authorize =</span> <span class="st">&quot;authorize&quot;</span>, <span class="dt">access =</span> <span class="st">&quot;access_token&quot;</span>, <span class="dt">base_url =</span> <span class="st">&quot;https://github.com/login/oauth&quot;</span>)</code></pre>
<ul>
<li>Register an application at <a href="https://github.com/settings/applications" class="uri">https://github.com/settings/applications</a>. Use any URL you would like for the homepage URL (<a href="http://github.com" class="uri">http://github.com</a> is fine) and <a href="http://localhost:1410" class="uri">http://localhost:1410</a> as the callback url. Insert your client ID and secret below - if secret is omitted, it will look it up in the GITHUB_CONSUMER_SECRET environmental variable.</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">myapp &lt;-<span class="st"> </span><span class="kw">oauth_app</span>(<span class="dt">appname =</span> <span class="st">&quot;github&quot;</span>, <span class="dt">key =</span> <span class="st">&quot;&lt;key&gt;&quot;</span>, <span class="dt">secret =</span> <span class="st">&quot;&lt;secret&gt;&quot;</span>)</code></pre>
<ul>
<li>Get OAuth credentials</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">github_token &lt;-<span class="st"> </span><span class="kw">oauth2.0_token</span>(endpts, myapp)</code></pre>
<ul>
<li>Use API</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">gtoken &lt;-<span class="st"> </span><span class="kw">config</span>(<span class="dt">token =</span> github_token)
req &lt;-<span class="st"> </span><span class="kw">GET</span>(<span class="st">&quot;https://api.github.com/rate_limit&quot;</span>, gtoken)
<span class="kw">content</span>(req)</code></pre>
</div>
<div id="cookies" class="section level2">
<h2><span class="header-section-number">7.10</span> cookies</h2>
<blockquote>
<p>Set or get cookies.</p>
</blockquote>
<ul>
<li><code>httr</code>: <code>set_cookies()</code>, <code>cookies()</code></li>
<li><code>RCurl</code>: <code>cookie</code></li>
</ul>
<p>Set cookies</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">GET</span>(<span class="st">&quot;http://httpbin.org/cookies&quot;</span>, <span class="kw">set_cookies</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="dv">2</span>))
<span class="co">#&gt; Response [http://httpbin.org/cookies]</span>
<span class="co">#&gt;   Date: 2016-04-15 13:53</span>
<span class="co">#&gt;   Status: 200</span>
<span class="co">#&gt;   Content-Type: application/json</span>
<span class="co">#&gt;   Size: 51 B</span>
<span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;   &quot;cookies&quot;: {</span>
<span class="co">#&gt;     &quot;a&quot;: &quot;1&quot;, </span>
<span class="co">#&gt;     &quot;b&quot;: &quot;2&quot;</span>
<span class="co">#&gt;   }</span>
<span class="co">#&gt; }</span></code></pre>
<p>If there are cookies in a response, you can access them easily with <code>cookies()</code></p>
<pre class="sourceCode r"><code class="sourceCode r">res &lt;-<span class="st"> </span><span class="kw">GET</span>(<span class="st">&quot;http://httpbin.org/cookies/set&quot;</span>, <span class="dt">query =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="dv">2</span>))
<span class="kw">cookies</span>(res)
<span class="co">#&gt;        domain  flag path secure expiration name value</span>
<span class="co">#&gt; 1 httpbin.org FALSE    /  FALSE       &lt;NA&gt;    a     1</span>
<span class="co">#&gt; 2 httpbin.org FALSE    /  FALSE       &lt;NA&gt;    b     2</span></code></pre>
</div>
<div id="progress" class="section level2">
<h2><span class="header-section-number">7.11</span> progress</h2>
<blockquote>
<p>Print curl progress</p>
</blockquote>
<ul>
<li><code>httr</code>: <code>progress()</code></li>
<li><code>RCurl</code>: <code>progressfunction</code></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">res &lt;-<span class="st"> </span><span class="kw">GET</span>(<span class="st">&quot;http://httpbin.org&quot;</span>, <span class="kw">progress</span>())
<span class="co">#&gt; |==================================| 100%</span></code></pre>
<ul>
<li><em>Why use this?</em> As you could imagine, this is increasingly useful as a request for a web resource takes longer and longer. For very long requests, this will help you know approximately when a request will finish.</li>
</ul>
</div>
<div id="proxies" class="section level2">
<h2><span class="header-section-number">7.12</span> proxies</h2>
<blockquote>
<p>When behind a proxy, give authentiction details for your proxy.</p>
</blockquote>
<ul>
<li><code>httr</code>: <code>use_proxy()</code></li>
<li><code>RCurl</code>: See various curl options that start with <code>proxy</code></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">GET</span>(<span class="st">&quot;http://www.google.com/search&quot;</span>, <span class="kw">use_proxy</span>(<span class="dt">url =</span> <span class="st">&quot;125.39.66.66&quot;</span>, <span class="dt">port =</span> <span class="dv">80</span>, <span class="dt">username =</span> <span class="st">&quot;username&quot;</span>, <span class="dt">password =</span> <span class="st">&quot;password&quot;</span>))</code></pre>
<ul>
<li><em>Why use this?</em> Most of us likely don’t need to worry about this. However, if you are in a work place, or maybe in certain geographic locations, you may have to use a proxy. I haven’t personally used a proxy in R, so any feedback on this is great.</li>
</ul>
</div>
<div id="user-agent" class="section level2">
<h2><span class="header-section-number">7.13</span> user agent</h2>
<blockquote>
<p>Some resources require a user-agent string.</p>
</blockquote>
<ul>
<li><code>httr</code>: <code>user_agent()</code></li>
<li><code>RCurl</code>: <code>useragent</code></li>
</ul>
<p>Get the default user agent set if using <code>httr</code></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">GET</span>(<span class="st">&quot;http://httpbin.org/user-agent&quot;</span>)
<span class="co">#&gt; Response [http://httpbin.org/user-agent]</span>
<span class="co">#&gt;   Date: 2016-04-15 13:53</span>
<span class="co">#&gt;   Status: 200</span>
<span class="co">#&gt;   Content-Type: application/json</span>
<span class="co">#&gt;   Size: 61 B</span>
<span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;   &quot;user-agent&quot;: &quot;libcurl/7.43.0 r-curl/0.9.7 httr/1.1.0&quot;</span>
<span class="co">#&gt; }</span></code></pre>
<p>Set a user agent string</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">GET</span>(<span class="st">&quot;http://httpbin.org/user-agent&quot;</span>, <span class="kw">user_agent</span>(<span class="st">&quot;its me!&quot;</span>))
<span class="co">#&gt; Response [http://httpbin.org/user-agent]</span>
<span class="co">#&gt;   Date: 2016-04-15 13:53</span>
<span class="co">#&gt;   Status: 200</span>
<span class="co">#&gt;   Content-Type: application/json</span>
<span class="co">#&gt;   Size: 30 B</span>
<span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;   &quot;user-agent&quot;: &quot;its me!&quot;</span>
<span class="co">#&gt; }</span></code></pre>
<ul>
<li><em>Why use this?</em> This is set by default in a http request, as you can see in the first example above for user agent. Some web APIs require that you set a specific user agent. For example, the <a href="https://developer.github.com/v3/#user-agent-required">GitHub API</a> requires that you include a user agent string in the header of each request that is your username or the name of your application so they can contact you if there is a problem.</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="api-clients.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ftp.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/sckott/wdclients/edit/master/curl.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>


</body>

</html>
